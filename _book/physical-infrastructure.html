<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>5 Physical Infrastructure | Getting Started with the Climate Adaptation Data Platform</title>
  <meta name="description" content="5 Physical Infrastructure | Getting Started with the Climate Adaptation Data Platform" />
  <meta name="generator" content="bookdown 0.39 and GitBook 2.6.7" />

  <meta property="og:title" content="5 Physical Infrastructure | Getting Started with the Climate Adaptation Data Platform" />
  <meta property="og:type" content="book" />
  
  
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="5 Physical Infrastructure | Getting Started with the Climate Adaptation Data Platform" />
  
  
  

<meta name="author" content="Brian Lee Yung Rowe" />


<meta name="date" content="2024-06-24" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="use-cases.html"/>
<link rel="next" href="mobile-app.html"/>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<script src="libs/accessible-code-block-0.0.1/empty-anchor.js"></script>
<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>



<style type="text/css">
  
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Getting Started with the Climate Adaptation Data Platform</a></li>

<li class="divider"></li>
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Preface</a>
<ul>
<li class="chapter" data-level="1.1" data-path="index.html"><a href="index.html#license"><i class="fa fa-check"></i><b>1.1</b> License</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="overview.html"><a href="overview.html"><i class="fa fa-check"></i><b>2</b> Overview</a></li>
<li class="chapter" data-level="3" data-path="quick-start.html"><a href="quick-start.html"><i class="fa fa-check"></i><b>3</b> Quick Start</a>
<ul>
<li class="chapter" data-level="3.1" data-path="quick-start.html"><a href="quick-start.html#system-requirements"><i class="fa fa-check"></i><b>3.1</b> System Requirements</a>
<ul>
<li class="chapter" data-level="3.1.1" data-path="quick-start.html"><a href="quick-start.html#linux"><i class="fa fa-check"></i><b>3.1.1</b> Linux</a></li>
<li class="chapter" data-level="3.1.2" data-path="quick-start.html"><a href="quick-start.html#docker"><i class="fa fa-check"></i><b>3.1.2</b> Docker</a></li>
</ul></li>
<li class="chapter" data-level="3.2" data-path="quick-start.html"><a href="quick-start.html#building-the-platform"><i class="fa fa-check"></i><b>3.2</b> Building the Platform</a></li>
<li class="chapter" data-level="3.3" data-path="quick-start.html"><a href="quick-start.html#platform-demos"><i class="fa fa-check"></i><b>3.3</b> Platform Demos</a>
<ul>
<li class="chapter" data-level="3.3.1" data-path="quick-start.html"><a href="quick-start.html#get-available-demos"><i class="fa fa-check"></i><b>3.3.1</b> Get available demos</a></li>
<li class="chapter" data-level="3.3.2" data-path="quick-start.html"><a href="quick-start.html#deploy-a-demo"><i class="fa fa-check"></i><b>3.3.2</b> Deploy a demo</a></li>
<li class="chapter" data-level="3.3.3" data-path="quick-start.html"><a href="quick-start.html#view-dashboard"><i class="fa fa-check"></i><b>3.3.3</b> View dashboard</a></li>
<li class="chapter" data-level="3.3.4" data-path="quick-start.html"><a href="quick-start.html#reset-system"><i class="fa fa-check"></i><b>3.3.4</b> Reset system</a></li>
</ul></li>
<li class="chapter" data-level="3.4" data-path="quick-start.html"><a href="quick-start.html#viewing-the-dashboard"><i class="fa fa-check"></i><b>3.4</b> Viewing the dashboard</a>
<ul>
<li class="chapter" data-level="3.4.1" data-path="quick-start.html"><a href="quick-start.html#policymaker-dashboard"><i class="fa fa-check"></i><b>3.4.1</b> Policymaker dashboard</a></li>
<li class="chapter" data-level="3.4.2" data-path="quick-start.html"><a href="quick-start.html#system-administration-dashboard"><i class="fa fa-check"></i><b>3.4.2</b> System administration dashboard</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="4" data-path="use-cases.html"><a href="use-cases.html"><i class="fa fa-check"></i><b>4</b> Use Cases</a>
<ul>
<li class="chapter" data-level="4.1" data-path="use-cases.html"><a href="use-cases.html#public-health"><i class="fa fa-check"></i><b>4.1</b> Public health</a>
<ul>
<li class="chapter" data-level="4.1.1" data-path="use-cases.html"><a href="use-cases.html#early-warning-systems"><i class="fa fa-check"></i><b>4.1.1</b> Early warning systems</a></li>
<li class="chapter" data-level="4.1.2" data-path="use-cases.html"><a href="use-cases.html#heat-risk"><i class="fa fa-check"></i><b>4.1.2</b> Heat risk</a></li>
<li class="chapter" data-level="4.1.3" data-path="use-cases.html"><a href="use-cases.html#mosquito-borne-infectious-disease"><i class="fa fa-check"></i><b>4.1.3</b> Mosquito-borne infectious disease</a></li>
</ul></li>
<li class="chapter" data-level="4.2" data-path="use-cases.html"><a href="use-cases.html#precision-agriculture"><i class="fa fa-check"></i><b>4.2</b> Precision agriculture</a>
<ul>
<li class="chapter" data-level="4.2.1" data-path="use-cases.html"><a href="use-cases.html#dry-soil-forecasting"><i class="fa fa-check"></i><b>4.2.1</b> Dry soil forecasting</a></li>
<li class="chapter" data-level="4.2.2" data-path="use-cases.html"><a href="use-cases.html#crop-water-needs"><i class="fa fa-check"></i><b>4.2.2</b> Crop water needs</a></li>
<li class="chapter" data-level="4.2.3" data-path="use-cases.html"><a href="use-cases.html#irrigation-control"><i class="fa fa-check"></i><b>4.2.3</b> Irrigation control</a></li>
<li class="chapter" data-level="4.2.4" data-path="use-cases.html"><a href="use-cases.html#freeze-warnings"><i class="fa fa-check"></i><b>4.2.4</b> Freeze warnings</a></li>
</ul></li>
<li class="chapter" data-level="4.3" data-path="use-cases.html"><a href="use-cases.html#hotter-times"><i class="fa fa-check"></i><b>4.3</b> Hotter Times</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="physical-infrastructure.html"><a href="physical-infrastructure.html"><i class="fa fa-check"></i><b>5</b> Physical Infrastructure</a>
<ul>
<li class="chapter" data-level="5.1" data-path="physical-infrastructure.html"><a href="physical-infrastructure.html#direct-wifi-connections"><i class="fa fa-check"></i><b>5.1</b> Direct WiFi connections</a></li>
<li class="chapter" data-level="5.2" data-path="physical-infrastructure.html"><a href="physical-infrastructure.html#ble-connections"><i class="fa fa-check"></i><b>5.2</b> BLE connections</a>
<ul>
<li class="chapter" data-level="5.2.1" data-path="physical-infrastructure.html"><a href="physical-infrastructure.html#data-routing-algorithm"><i class="fa fa-check"></i><b>5.2.1</b> Data routing algorithm</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="6" data-path="mobile-app.html"><a href="mobile-app.html"><i class="fa fa-check"></i><b>6</b> Mobile app</a>
<ul>
<li class="chapter" data-level="6.1" data-path="mobile-app.html"><a href="mobile-app.html#key-user-stories"><i class="fa fa-check"></i><b>6.1</b> Key user stories</a>
<ul>
<li class="chapter" data-level="6.1.1" data-path="mobile-app.html"><a href="mobile-app.html#i-want-to-pair-my-phone-to-a-device"><i class="fa fa-check"></i><b>6.1.1</b> I want to pair my phone to a device</a></li>
<li class="chapter" data-level="6.1.2" data-path="mobile-app.html"><a href="mobile-app.html#i-want-to-view-recent-device-data"><i class="fa fa-check"></i><b>6.1.2</b> I want to view recent device data</a></li>
<li class="chapter" data-level="6.1.3" data-path="mobile-app.html"><a href="mobile-app.html#i-want-to-unpair-a-device"><i class="fa fa-check"></i><b>6.1.3</b> I want to unpair a device</a></li>
<li class="chapter" data-level="6.1.4" data-path="mobile-app.html"><a href="mobile-app.html#i-want-to-view-the-available-risk-alerts-i-can-subscribe-to"><i class="fa fa-check"></i><b>6.1.4</b> I want to view the available risk alerts I can subscribe to</a></li>
<li class="chapter" data-level="6.1.5" data-path="mobile-app.html"><a href="mobile-app.html#i-want-to-subscribe-to-heat-risk-alerts"><i class="fa fa-check"></i><b>6.1.5</b> I want to subscribe to heat risk alerts</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="7" data-path="device-operation.html"><a href="device-operation.html"><i class="fa fa-check"></i><b>7</b> Device Operation</a>
<ul>
<li class="chapter" data-level="7.1" data-path="device-operation.html"><a href="device-operation.html#components"><i class="fa fa-check"></i><b>7.1</b> Components</a>
<ul>
<li class="chapter" data-level="7.1.1" data-path="device-operation.html"><a href="device-operation.html#connectors"><i class="fa fa-check"></i><b>7.1.1</b> Connectors</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="8" data-path="cadp-architecture.html"><a href="cadp-architecture.html"><i class="fa fa-check"></i><b>8</b> CADP Architecture</a>
<ul>
<li class="chapter" data-level="8.1" data-path="cadp-architecture.html"><a href="cadp-architecture.html#design-principles"><i class="fa fa-check"></i><b>8.1</b> Design principles</a></li>
<li class="chapter" data-level="8.2" data-path="cadp-architecture.html"><a href="cadp-architecture.html#database"><i class="fa fa-check"></i><b>8.2</b> Database</a></li>
<li class="chapter" data-level="8.3" data-path="cadp-architecture.html"><a href="cadp-architecture.html#sensor-data-ingestion"><i class="fa fa-check"></i><b>8.3</b> Sensor data ingestion</a>
<ul>
<li class="chapter" data-level="8.3.1" data-path="cadp-architecture.html"><a href="cadp-architecture.html#raw-sensor-data"><i class="fa fa-check"></i><b>8.3.1</b> Raw sensor data</a></li>
<li class="chapter" data-level="8.3.2" data-path="cadp-architecture.html"><a href="cadp-architecture.html#data-issues"><i class="fa fa-check"></i><b>8.3.2</b> Data issues</a></li>
</ul></li>
<li class="chapter" data-level="8.4" data-path="cadp-architecture.html"><a href="cadp-architecture.html#weather-forecasting"><i class="fa fa-check"></i><b>8.4</b> Weather forecasting</a>
<ul>
<li class="chapter" data-level="8.4.1" data-path="cadp-architecture.html"><a href="cadp-architecture.html#ecmwf-forecasts"><i class="fa fa-check"></i><b>8.4.1</b> ECMWF forecasts</a></li>
</ul></li>
<li class="chapter" data-level="8.5" data-path="cadp-architecture.html"><a href="cadp-architecture.html#early-warning-system"><i class="fa fa-check"></i><b>8.5</b> Early warning system</a></li>
</ul></li>
<li class="chapter" data-level="9" data-path="forecasting-algorithms.html"><a href="forecasting-algorithms.html"><i class="fa fa-check"></i><b>9</b> Forecasting algorithms</a>
<ul>
<li class="chapter" data-level="9.1" data-path="forecasting-algorithms.html"><a href="forecasting-algorithms.html#air-temperature"><i class="fa fa-check"></i><b>9.1</b> Air temperature</a></li>
<li class="chapter" data-level="9.2" data-path="forecasting-algorithms.html"><a href="forecasting-algorithms.html#soil-moisture"><i class="fa fa-check"></i><b>9.2</b> Soil moisture</a></li>
</ul></li>
<li class="chapter" data-level="10" data-path="risk-protocols.html"><a href="risk-protocols.html"><i class="fa fa-check"></i><b>10</b> Risk Protocols</a>
<ul>
<li class="chapter" data-level="10.1" data-path="risk-protocols.html"><a href="risk-protocols.html#soil-moisture-1"><i class="fa fa-check"></i><b>10.1</b> Soil moisture</a></li>
</ul></li>
<li class="chapter" data-level="11" data-path="contributing-to-cadp.html"><a href="contributing-to-cadp.html"><i class="fa fa-check"></i><b>11</b> Contributing to CADP</a>
<ul>
<li class="chapter" data-level="11.1" data-path="contributing-to-cadp.html"><a href="contributing-to-cadp.html#our-kanban-process"><i class="fa fa-check"></i><b>11.1</b> Our Kanban process</a>
<ul>
<li class="chapter" data-level="11.1.1" data-path="contributing-to-cadp.html"><a href="contributing-to-cadp.html#lean-production"><i class="fa fa-check"></i><b>11.1.1</b> Lean production</a></li>
<li class="chapter" data-level="11.1.2" data-path="contributing-to-cadp.html"><a href="contributing-to-cadp.html#loose-coupling-and-asynchronous-communication"><i class="fa fa-check"></i><b>11.1.2</b> Loose coupling and asynchronous communication</a></li>
<li class="chapter" data-level="11.1.3" data-path="contributing-to-cadp.html"><a href="contributing-to-cadp.html#kanban-for-project-management"><i class="fa fa-check"></i><b>11.1.3</b> Kanban for project management</a></li>
<li class="chapter" data-level="11.1.4" data-path="contributing-to-cadp.html"><a href="contributing-to-cadp.html#the-need-for-discipline"><i class="fa fa-check"></i><b>11.1.4</b> The need for discipline</a></li>
</ul></li>
<li class="chapter" data-level="11.2" data-path="contributing-to-cadp.html"><a href="contributing-to-cadp.html#micropython"><i class="fa fa-check"></i><b>11.2</b> Micropython</a>
<ul>
<li class="chapter" data-level="11.2.1" data-path="contributing-to-cadp.html"><a href="contributing-to-cadp.html#unix-port"><i class="fa fa-check"></i><b>11.2.1</b> UNIX port</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="12" data-path="references.html"><a href="references.html"><i class="fa fa-check"></i><b>12</b> References</a></li>
<li class="divider"></li>
<li><a href="https://hottertimes.com" target="blank">Hotter Times</a></li>
<li><a href="https://zatonovo.com" target="blank">Copyright 2024 Zato Novo</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Getting Started with the Climate Adaptation Data Platform</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="physical-infrastructure" class="section level1 hasAnchor" number="5">
<h1><span class="header-section-number">5</span> Physical Infrastructure<a href="physical-infrastructure.html#physical-infrastructure" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<p>Devices can connect with the CADP via different means.
Figure <a href="physical-infrastructure.html#fig:device-networking">5.1</a> shows two different approaches.
The simplest approach is to connect directly via WiFi.
In this approach, a device communicates directly with the CADP MQTT server.
This approach works well when reliable WiFi is available.</p>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:device-networking"></span>
<img src="images/device_networking.png" alt="Different network configuration of system." width="720" />
<p class="caption">
Figure 5.1: Different network configuration of system.
</p>
</div>
<p>The method used for remote areas with limited infastructure utilizes
a mobile phone as an intermediary.
In this approach we assume that mobile phones (with a network connection)
exist in proximity to devices but they are no fixed internet gateways.
We call the mobile phones ephemeral gateways because they may disappear
at any time.</p>
<p>Ephemeral gateways (EGs) offer a temporary network connection.
The EG is responsible for pushing data to the CADP MQTT server.
If a network connection is unavailable,
it will cache the data on the mobile phone until a network connection is
available.
Once a connection is established, the EG must push the data to the server.</p>
<p>Devices are connected together via the LoRa wireless protocol.
When a particular device connects with an ephemeral gateway,
it broadcasts a message to other connected devices and notifies them
that it has a network connection.
This device will attempt to upload as much data to the mobile device as
possible.</p>
<p>Devices that receive this message will begin broadcasting data to be received
by the device connected to the EG.
The broadcast includes the ID of the device connected to the EG.
Only the device connected to the EG can broadcast an ack back.</p>
<p>In the event that multiple EGs are available,
each device is responsible for choosing the device to use as the target EG.</p>
<div id="direct-wifi-connections" class="section level2 hasAnchor" number="5.1">
<h2><span class="header-section-number">5.1</span> Direct WiFi connections<a href="physical-infrastructure.html#direct-wifi-connections" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Devices connected via WiFi will start a MQTT client to send directly to
the cloud MQTT broker.
By default, the MQTT broker host is <code>mqtt.zeomancer.com</code>.</p>
</div>
<div id="ble-connections" class="section level2 hasAnchor" number="5.2">
<h2><span class="header-section-number">5.2</span> BLE connections<a href="physical-infrastructure.html#ble-connections" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>When a smartphone connects to a device via BLE, a few things happen:</p>
<ul>
<li>the device sends a test data packet to confirm that data is sent to the MQTT broker</li>
<li>the device waits for an ack from the smartphone</li>
<li>if successful,
<ul>
<li>LoRa is activated</li>
<li>a <code>internet_available</code> message is broadcast over LoRa</li>
</ul></li>
</ul>
<div id="data-routing-algorithm" class="section level3 hasAnchor" number="5.2.1">
<h3><span class="header-section-number">5.2.1</span> Data routing algorithm<a href="physical-infrastructure.html#data-routing-algorithm" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>The data routing algorithm solves one key problem, which is the existence
of ephemeral gateways.
Devices are connected to each other via LoRa.
The goal is to efficiently route data through the LoRa network to
devices that are connected to the network (a “connected device”).
LoRa works via a broadcast mechanism, so devices are either
in range or out of range of a connected device.</p>
<p>If a device is in range, then the device simply broadcasts its data to
the target connected device.
Any other device that receives the message will ignore the message
if the target id does not match its device id.</p>
<p>For a device that is out of range, it will send data to the nearest device
in range of a connected device.
The devices can be modeled as a graph where each device is a node
and edges represent the signal strength between them.
We can define two relevant distance metrics between two arbitrary nodes:</p>
<ul>
<li>the number of edges (aka hops) between nodes;</li>
<li>the harmonic mean of the signal strength of the edges separating the nodes.</li>
</ul>
<p>A device chooses a target device by considering the harmonic mean of
the signal strengths between it and a connected device.
Generally, the device should choose the path with the highest value.
Note that this may change as EGs can move around and disappear altogether.</p>

</div>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="use-cases.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="mobile-app.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/rstudio/bookdown-demo/edit/master/05-physical_infrastructure.Rmd",
"text": "Edit"
},
"history": {
"link": null,
"text": null
},
"view": {
"link": "https://github.com/zatonovo/cadp_docs/blob/main/05-physical_infrastructure.Rmd",
"text": null
},
"download": ["_main.pdf", "_main.epub"],
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/latest.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
